[TOC]

2018-06-04，由[朱寅](mailto:zhuyin@chinamobile.com)创建。

更新历史：

1. 

# 和指数平台数据库设计

## 应用信息表 app_info

```sql
create table app_info(
    id int not null auto_increment,
    name varchar(32) not null comment '应用名',
    category int not null comment '应用类别id',  
	flag int not null comment '是否为移动自有产品 1 是 0 不是', 
	special int comment not null '是否为指定app 1 是 0 不是',
    atime datetime not null comment '记录添加时间',
    primary key(id),
    unique key uk_app_category(name,category)
);

insert into app_info values(null, '腾讯视频', '1', '', '2018-05-24' );
insert into app_info values(null, '支付宝', '2', '', '2018-05-24' );
insert into app_info values(null, '爱奇艺', '1', '', '2018-05-24' );
```



数据示例

```sql
mysql> select * from app_category limit 2;
+----+-----------------+---------------------+
| id | name            | atime               |
+----+-----------------+---------------------+
|  1 | 移动视频类      | 2018-05-24 00:00:00 |
|  2 | 移动支付类      | 2018-05-24 08:40:05 |
+----+-----------------+---------------------+
```

## 应用信息表 app_logo

```sql
create table app_logo(
    id int not null auto_increment,
    app int not null comment '应用id',  
	logo text not null comment 'app logo图片的base64字符串',
    primary key(id),
	unique key uk_app_logo(app)
);

insert into app_info values(null, '腾讯视频', '1', '', '2018-05-24' );
insert into app_info values(null, '支付宝', '2', '', '2018-05-24' );
insert into app_info values(null, '爱奇艺', '1', '', '2018-05-24' );
```

## 应用类别表 app_category

```sql
create table app_category(
    id int not null auto_increment,
    name varchar(32) not null comment '类别名',
    atime datetime not null comment '记录添加时间',
    primary key(id),
    unique key uk_name(name)
);

insert into app_category values(null, '移动视频类', '2018-05-24');
insert into app_category values(null, '移动支付类', '2018-05-24 8:40:05');
```



数据示例

```sql
mysql> select * from app_category limit 2;
+----+-----------------+---------------------+
| id | name            | atime               |
+----+-----------------+---------------------+
|  1 | 移动视频类      | 2018-05-24 00:00:00 |
|  2 | 移动支付类      | 2018-05-24 08:40:05 |
+----+-----------------+---------------------+
```



## 应用月活表 app_mau

```sql
create table app_mau(
    id int not null auto_increment,
    app int not null comment '应用id',
    month char(6) not null comment '月份',
    mau bigint not null comment '月活跃用户数',
    basis double not null comment '环比增幅',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_mau(app, month)
);

insert into app_mau values(null, '1', '201712', 581770205, 0.05, '2018-05-24');
insert into app_mau values(null, '2', '201712', 447152212, 0.05, '2018-05-24');
insert into app_mau values(null, '3', '201712', 375532308, 0.05, '2018-05-24');
```



数据示例

```sql
mysql> select * from app_mau limit 2;
+----+-----+--------+-----------+-------+---------------------+
| id | app | month  | mau       | basis | atime               |
+----+-----+--------+-----------+-------+---------------------+
|  1 |   1 | 201712 | 581770205 |  0.05 | 2018-05-24 00:00:00 |
|  2 |   2 | 201712 | 447152212 |  0.05 | 2018-05-24 00:00:00 |
+----+-----+--------+-----------+-------+---------------------+
```

## 应用品质表 app_quality

```sql
create table app_quality(
    id int not null auto_increment,
	app int not null comment '应用id',
	category int comment '应用类别id',  
    features double comment '功能',
	view double comment '界面',
	delay double comment '延时',
	consume double comment '功耗',
	experience double comment '使用体验',
	qindex double comment '体验指数',
	version varchar(32) not null comment '产品版本',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_quality(app, month,category)
);


```

## 应用运营表 app_operations

```sql
create table app_operations(
    id int not null auto_increment,
	app int not null comment '应用id',
	category int not null comment '应用类别id',  
    content double comment '内容',
	channel double comment '渠道',
	tariff double comment '资费',
	service double comment '服务',
	market double comment '营销',
	experience double comment '运营体验',
	oindex double comment '运营指数',
	version varchar(32) not null comment '产品版本',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_operations(app, month,category)
);


```

## 应用类别描述表 app_summary

```sql
create table app_summary(
    id int not null auto_increment,
	category int not null comment '类别id',
    des1 text not null comment '品质描述',
	des2 text not null comment '运营描述',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_summary(category, month)
);


```

## 应用情感表 app_emotion

```sql
create table app_emotion(
    id int not null auto_increment,
	category int not null comment '类别id',
	app int not null comment '应用id',
    t_score double not null comment '净好评率',
	mau_t_score double not null comment 'mau_t_score',
	emotion_raw double not null comment 'emotion_raw',
	z_score double not null comment 'z_score',
	sd int not null comment 'sd',
	avg int not null comment 'avg',
	emotion double not null comment '情感得分',
	features varchar(32) comment '特点',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_emotion(category, month)
);


```

## 应用特点表 app_features（废弃）

```sql
create table app_features(
    id int not null auto_increment,
	app int not null comment '应用id',
	features text not null comment '关键特点',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_features(app, month)
);


```

## 应用评论表 app_comment

```sql
create table app_comment(
    id int not null auto_increment,
	category int not null comment '类别id',
	app int not null comment '应用id',
	source varchar(32) not null comment '来源',
	comm text not null comment '评论',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_comment(category, month,app)
);


```

## 应用延时功耗原始表 app_original_delay

```sql
create table app_original_delay(
    id int not null auto_increment,
	app int not null comment '应用id',
	category int not null comment '类别id',
	version varchar(32) not null comment '应用版本',
	measuring varchar(32) not null comment '测量指标',
	network varchar(32) not null comment '网络环境',
	measure double not null comment '测量值',
	standard double not null comment '达标值',
	challenge double not null comment '挑战值',
	status int not null comment '数据状态',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id)
);

```

## 应用功能界面原始表 app_original_features

```sql
create table app_original_features(
    id int not null auto_increment,
	app int not null comment '应用id',
	category int not null comment '类别id',
	version varchar(32) not null comment '应用版本',
	dimensions varchar(32) not null comment '问题维度',
	des text not null comment '问题描述',
	experience int not null comment '体验影响程度',
	frequency int not null comment '预期发生频率',
	score int not null comment '严重等级得分',
	degree varchar(32) not null comment '严重等级',
	status int not null comment '数据状态',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id)
);

```

## 应用品质计算值表 app_calculation_quality

```sql
create table app_calculation_quality(
    id int not null auto_increment,
	app int not null comment '应用id',
	category int comment '应用类别id',  
    features double comment '功能',
	view double comment '界面',
	delay double comment '延时',
	consume double comment '功耗',
	experience double comment '使用体验',
	version varchar(32) not null comment '产品版本',
	status int not null comment '是否处理 0 未处理 1 处理',
    month char(6) not null comment '月份',
    atime datetime not null comment '记录添加时间',
    primary key(id),
	unique key uk_app_quality(app, month,category)
);

```
## 应用品质权重表 app_weight_quality

```sql
create table app_weight_quality(
    id int not null auto_increment,
	category int comment '应用类别id', 
	w3g double not null comment '3G权重',
	w4g double not null comment '4G权重',  
    wwlan double not null comment 'WLAN权重',
	whigh int not null comment '高严重等级权重',
	wmiddle int not null comment '中严重等级权重', 
	wlow int not null comment '低严重等级权重',
	wfeatures double not null comment '功能权重',
	wview double not null comment '界面权重',
	wdelay double not null comment '延时权重',
	wconsume double not null comment '功能权重',
	wexperience double not null comment '体验权重',
    primary key(id),
	unique key uk_app_calculation(category)
);


```

## 市场指数月表 app_market

```sql
CREATE TABLE `app_market` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `category` int(11) DEFAULT NULL COMMENT '应用类别id',
  `app` int(11) NOT NULL COMMENT '应用id',
  `total_user` int(11) NOT NULL COMMENT '累计用户数',
  `new_user` int(11) NOT NULL COMMENT '新增用户数',
  `keep_rate` double NOT NULL COMMENT '次月留存率',
  `length_time` double NOT NULL COMMENT '月人均使用时长',
  `flow` double NOT NULL COMMENT '月人均使用流量',
  `market` double NOT NULL COMMENT '市场指数',
  `month` char(6) COLLATE utf8_unicode_ci NOT NULL COMMENT '月份',
  `atime` datetime NOT NULL COMMENT '记录添加时间',
  `mau_number` double NOT NULL COMMENT '月均活跃用户数',
  `new_user_retention_rate` double NOT NULL DEFAULT '0' COMMENT '新增用户次月留存率',
  `monthly_active_day_per_person` double NOT NULL COMMENT '月人均活跃天数（天）',
  `monthly_low_freq_user_rate` double NOT NULL COMMENT '月低频使用用户占比（%）',
  `monthly_duration_per_person` double NOT NULL COMMENT '月人均使用时长（分钟）',
  `monthly_dataflow_per_person` double NOT NULL COMMENT '月人均流量',
  `next_month_retention_num` double NOT NULL COMMENT '次月留存用户数（万）',
  `next_month_loss_num` double NOT NULL COMMENT '次月流失用户数（万）',
  `next_month_recurring_num` double NOT NULL COMMENT '次月回流用户数（万）',
  `active_next_month_retention_rate` double NOT NULL COMMENT '活跃用户次月留存率（%）',
  `active_next_month_loss_rate` double NOT NULL COMMENT '活跃用户次月流失率（%）',
  `loss_next_month_recurring_rate` double NOT NULL COMMENT '流失用户次月回流率（%）',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_app_quality` (`app`,`month`,`category`)
)

```
## 市场指数周表 app_market_week
```sql
CREATE TABLE `app_market_week` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `category` int(11) DEFAULT NULL COMMENT '应用类别id',
  `app` int(11) NOT NULL COMMENT '应用id',
  `total_active_num` bigint(12) NOT NULL COMMENT '累计活跃用户总数',
  `penetration_rate` float(8,5) NOT NULL COMMENT '周用户渗透率',
  `new_user` bigint(10) NOT NULL COMMENT '周新增用户数',
  `new_user_retention_rate` float(8,5) NOT NULL DEFAULT '0' COMMENT '新增用户次周留存率',
  `weeky_active` bigint(12) NOT NULL COMMENT '周活跃用户数',
  `weekly_active_day_per_person` float(8,5) NOT NULL COMMENT '周人均活跃天数（天）',
  `weekly_low_freq_user_rate` float(8,5) NOT NULL COMMENT  '周低频使用用户占比（%）',
  `next_week_retention_num` bigint(10) NOT NULL COMMENT '次周留存用户数（万）',
  `next_week_loss_num` bigint(10) NOT NULL COMMENT '次周流失用户数（万）',
  `next_week_recurring_num` bigint(10) NULLNOT NULL COMMENT '次周回流用户数（万）',
  `active_next_week_retention_rate` float(8,5) NOT NULL COMMENT '活跃用户次周留存率（%）',
  `active_next_week_loss_rate` float(8,5) NOT NULL COMMENT '活跃用户次周流失率（%）',
  `loss_next_week_recurring_rate` float(8,5) NOT NULL COMMENT '流失用户次周回流率（%）',
  `weekly_duration_per_person` float(10,3) NOT NULL COMMENT '周人均使用时长（分钟）',
  `weekly_dataflow_per_person` float(10,3) NOT  COMMENT '周人均流量',
  `week_active_rate`  float(8,5) NOT NULL COMMENT '周活跃用户度',
  `market_index_score` float(8,5) DEFAULT NULL,
  `week` char(6) COLLATE utf8_unicode_ci NOT NULL COMMENT '周', 
  `atime` datetime NOT NULL COMMENT '记录添加时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_app_quality` (`app`,`week`,`category`)

)
```

## 市场指数日表 app_market_date
```sql
CREATE TABLE `app_market_date` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `category` int(11) DEFAULT NULL COMMENT '应用类别id',
  `app` int(11) NOT NULL COMMENT '应用id',
  `total_active_num` bigint(12) NOT NULL COMMENT '累计活跃用户总数',
  `penetration_rate` float(8,5) NOT NULL COMMENT '日用户渗透率',
  `new_user` bigint(10) NOT NULL COMMENT '日新增用户数',
  `new_user_retention_rate` float(8,5) NOT NULL DEFAULT '0' COMMENT '新增用户次日留存率',
  `dately_active` bigint(12) NOT NULL COMMENT '日活跃用户数',
  `dately_active_day_per_person` float(8,5) NOT NULL COMMENT '日人均活跃天数（天）',
  `dately_low_freq_user_rate` float(8,5) NOT NULL COMMENT  '日低频使用用户占比（%）',
  `next_date_retention_num` bigint(10) NOT NULL COMMENT '次日留存用户数（万）',
  `next_date_loss_num` bigint(10) NOT NULL COMMENT '次日流失用户数（万）',
  `next_date_recurring_num` bigint(10) NOT NULL COMMENT '次日回流用户数（万）',
  `active_next_date_retention_rate` float(8,5) NOT NULL COMMENT '活跃用户次日留存率（%）',
  `active_next_date_loss_rate` float(8,5) NOT NULL COMMENT '活跃用户次日流失率（%）',
  `loss_next_date_recurring_rate` float(8,5) NOT NULL COMMENT '流失用户次日回流率（%）',
  `dately_duration_per_person` float(10,3) NOT NULL COMMENT '日人均使用时长（分钟）',
  `dately_dataflow_per_person` float(10,3) NOT NULL COMMENT '日人均流量',
  `date_active_rate` float(8,5) NOT NULL COMMENT '日活跃用户度',
  `market_index_score` float(8,5) DEFAULT NULL,
  `date` char(6) COLLATE utf8_unicode_ci NOT NULL COMMENT '日',
  `atime` datetime NOT NULL COMMENT '记录添加时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_app_quality` (`app`,`date`,`category`)
)
```

## 内容原始数据表 app_original_content（后台）

```sql
create table app_original_content(
    id int not null auto_increment,
    month varchar(32) not null comment '测评时间',
    category int not null comment '应用类别id',
    app int not null comment '应用名称id',
    version varchar(32) not null comment '产品版本',
    content_name varchar(32) not null comment '抽样内容名称',
    content_home varchar(32) not null comment '抽样内容归属',
    measured_index varchar(32) comment '测量指标', 
    measured_problem varchar(32)  comment '测量问题说明', 
    measured_value varchar(32) not null comment '测量值', 
    remarks varchar(32) not null comment '备注',
    atime datetime not null comment '记录添加时间',
    primary key(id), 
);
```

## 内容类别表 app_content_category（后台）
```sql
create table app_content_category(
    id int not null auto_increment,
    content_category varchar(32) not null auto_increment'内容类别表',
    primary key(id)
);
```

## 体验指数运营样本数据表 operate_original_data（后台）

```sql
CREATE TABLE `operate_sample_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键id',
  `month` char(6) COLLATE utf8_unicode_ci NOT NULL COMMENT '月份',
  `category` int(11) NOT NULL COMMENT '产品类型id',
  `app` int(11) NOT NULL COMMENT 'app应用id',
  `version` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '产品版本',
  `measure_index` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '测量指标',
  `specific_channel` varchar(32) COLLATE utf8_unicode_ci DEFAULT NULL COMMENT '具体渠道（仅渠道）',
  `server_from` varchar(32) COLLATE utf8_unicode_ci DEFAULT NULL COMMENT '具体服务形式（仅服务）',
  `test_value` char(1) COLLATE utf8_unicode_ci NOT NULL COMMENT '测量值（1/0）',
  `explain` varchar(200) COLLATE utf8_unicode_ci DEFAULT NULL COMMENT '详细说明',
  `
  `dimensions_id` int(11) NOT NULL COMMENT '产品维度ID',
  `atime` datetime NOT NULL COMMENT '记录添加时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

```

## 产品维度表 app_dimensions（后台）

```sql
CREATE TABLE `app_dimensions` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键id',
  `dimensions` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '维度名称',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

INSERT INTO `app_dimensions` VALUES ('2', '营销');
INSERT INTO `app_dimensions` VALUES ('3', '渠道');
INSERT INTO `app_dimensions` VALUES ('4', '资费');
INSERT INTO `app_dimensions` VALUES ('5', '服务');
```

## 体验指数运营原始数据表 app_calculation_operations（后台）

```sql
CREATE TABLE `app_calculation_operations` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `month` CHAR(6) COLLATE utf8_unicode_ci NOT NULL COMMENT '月份',
  `app` INT(11) NOT NULL COMMENT '应用id',
  `category` INT(11) NOT NULL COMMENT '应用类别id',
  `version` VARCHAR(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '产品版本',
  `content` DOUBLE DEFAULT NULL COMMENT '内容',
  `channel` DOUBLE DEFAULT NULL COMMENT '渠道',
  `tariff` DOUBLE DEFAULT NULL COMMENT '资费',
  `service` DOUBLE DEFAULT NULL COMMENT '服务',
  `market` DOUBLE DEFAULT NULL COMMENT '营销',
  `experience` DOUBLE DEFAULT NULL COMMENT '运营体验',
  `status` INT(11) NOT NULL COMMENT '数据状态（0：未转换，1：已转换）',
  `atime` DATETIME NOT NULL COMMENT '记录添加时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_app_operations` (`app`,`month`,`category`)
) ENGINE=INNODB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

```
## 口碑指数--情感分析结果表 app_emotion_analyze（后台）

```sql
CREATE TABLE `app_emotion_analyze` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `app` int(11) NOT NULL COMMENT '应用id',
  `category` int(11) NOT NULL COMMENT '应用类别id',
  `month` char(8) COLLATE utf8_unicode_ci NOT NULL,
  `comment_source` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '评论来源',
  `app_name` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '实际名称',
  `comment_attribute` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '评论属性',
  `user_score` int(11) NOT NULL COMMENT '用户评分',
  `user_name` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '用户名',
  `comment` varchar(64) COLLATE utf8_unicode_ci NOT NULL COMMENT '评论内容',
  `status` int(11) NOT NULL COMMENT '情感倾向（1：正，0：中,-1:负）',
  `atime` datetime NOT NULL COMMENT '记录添加时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=121 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

```
## 口碑指数-- 情感指数参数表app_emotion_parameter（后台）
```sql
CREATE TABLE `app_emotion_parameter` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `month` char(6) COLLATE utf8_unicode_ci NOT NULL COMMENT '指数期数',
  `category` int(11) NOT NULL COMMENT '产品类别',
  `app` int(11) NOT NULL COMMENT '产品名称',
  `freq_positive` int(11) NOT NULL COMMENT 'freq正性（1）',
  `freq_negativity` int(11) NOT NULL COMMENT 'freq负性（-1）',
  `freq_neutral` int(11) NOT NULL COMMENT 'freq中性（0）',
  `freq_sum` int(11) NOT NULL COMMENT 'freq总计',
  `pet_positive` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT 'pet正性百分比',
  `pet_negativity` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT 'pet负性百分比',
  `pet_neutral` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT 'pet中性百分比',
  `favorable_rate` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '净好评率',
  `favorable_rate_z` double(11,0) NOT NULL COMMENT '净好评率Z分',
  `favorable_rate_t` double(11,0) NOT NULL COMMENT '净好评率T分',
  `mau_z` double(11,0) NOT NULL COMMENT 'mau_z分',
  `mau_t` double(11,0) NOT NULL COMMENT 'mau_t分',
  `emotion_rate_original` double(11,0) NOT NULL COMMENT '情感指数原始分',
  `emotion_rate_z` double(11,0) NOT NULL COMMENT '情感指数t分',
  `emotion_score` double(11,0) NOT NULL COMMENT '情感得分',
  `atime` datetime NOT NULL COMMENT '记录添加时间',
  PRIMARY KEY (`id`),
  KEY `uk_app_emotion_parameter` (`month`,`app`)
) ENGINE=InnoDB AUTO_INCREMENT=137 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

```
## 口碑指数-- 热词表hot_word（后台）
```sql
CREATE TABLE `hot_word` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `app` int(11) NOT NULL COMMENT '产品id',
  `source` varchar(32) COLLATE utf8_unicode_ci DEFAULT NULL COMMENT '评论来源',
  `word_name` varchar(32) COLLATE utf8_unicode_ci NOT NULL COMMENT '热词词名',
  `word_frequency` int(10) NOT NULL,
  `date` char(8) COLLATE utf8_unicode_ci NOT NULL COMMENT '评论发表时间',
  `atime` char(10) COLLATE utf8_unicode_ci NOT NULL COMMENT '热词统计时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=19 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
```
